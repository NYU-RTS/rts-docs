<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-hpc/tools_and_software/conda_environments" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Conda Environments (Python, R) | Connecting researchers to computational resources.</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://services.rt.nyu.edu/pr-preview/pr-191/img/NYU.svg"><meta data-rh="true" name="twitter:image" content="https://services.rt.nyu.edu/pr-preview/pr-191/img/NYU.svg"><meta data-rh="true" property="og:url" content="https://services.rt.nyu.edu/pr-preview/pr-191/docs/hpc/tools_and_software/conda_environments/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Conda Environments (Python, R) | Connecting researchers to computational resources."><meta data-rh="true" name="description" content="This page describes how you can create conda environments without containers in $SCRATCH//home/$USER. We strongly encourage you to create conda environments within Overlay files attached to Apptainer containers as described in this section. Please note that creating both kinds of conda environments is strongly discouraged as it leads to packages from one environment being accidentally used in another."><meta data-rh="true" property="og:description" content="This page describes how you can create conda environments without containers in $SCRATCH//home/$USER. We strongly encourage you to create conda environments within Overlay files attached to Apptainer containers as described in this section. Please note that creating both kinds of conda environments is strongly discouraged as it leads to packages from one environment being accidentally used in another."><link data-rh="true" rel="icon" href="/pr-preview/pr-191/img/NYU.ico"><link data-rh="true" rel="canonical" href="https://services.rt.nyu.edu/pr-preview/pr-191/docs/hpc/tools_and_software/conda_environments/"><link data-rh="true" rel="alternate" href="https://services.rt.nyu.edu/pr-preview/pr-191/docs/hpc/tools_and_software/conda_environments/" hreflang="en"><link data-rh="true" rel="alternate" href="https://services.rt.nyu.edu/pr-preview/pr-191/docs/hpc/tools_and_software/conda_environments/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Conda Environments (Python, R)","item":"https://services.rt.nyu.edu/pr-preview/pr-191/docs/hpc/tools_and_software/conda_environments"}]}</script><link rel="alternate" type="application/rss+xml" href="/pr-preview/pr-191/blog/rss.xml" title="Connecting researchers to computational resources. RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/pr-preview/pr-191/blog/atom.xml" title="Connecting researchers to computational resources. Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2DXB3BDH70"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2DXB3BDH70",{anonymize_ip:!0})</script><link rel="stylesheet" href="/pr-preview/pr-191/assets/css/styles.f70cced0.css">
<script src="/pr-preview/pr-191/assets/js/runtime~main.e24a134b.js" defer="defer"></script>
<script src="/pr-preview/pr-191/assets/js/main.91b9914e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/pr-preview/pr-191/img/NYU.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_bHSa" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/pr-preview/pr-191/"><div class="navbar__logo"><img src="/pr-preview/pr-191/img/NYU.svg" alt="NYU torch logo" class="themedComponent_ypQ_ themedComponent--light_qQSo"><img src="/pr-preview/pr-191/img/NYU.svg" alt="NYU torch logo" class="themedComponent_ypQ_ themedComponent--dark_m0FH"></div><b class="navbar__title text--truncate">Research Technology Services</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/pr-preview/pr-191/docs/genai/getting_started/intro/">Pythia</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/pr-preview/pr-191/docs/hpc/getting_started/intro/">HPC</a><a class="navbar__item navbar__link" href="/pr-preview/pr-191/docs/cloud/getting_started/intro/">Cloud</a><a class="navbar__item navbar__link" href="/pr-preview/pr-191/docs/srde/getting_started/intro/">SRDE</a><a href="https://hsrn.nyu.edu/docs/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">HSRN<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_i9eD"><use href="#theme-svg-external-link"></use></svg></a><a class="navbar__item navbar__link" href="/pr-preview/pr-191/blog/">Announcements</a><div class="toggle_QBuD colorModeToggle_y_72"><button class="clean-btn toggleButton_lwp1 toggleButtonDisabled_HT4F" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_Djgd lightToggleIcon_DYGl"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_Djgd darkToggleIcon_IJRp"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_Djgd systemToggleIcon_dFXK"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_ASv1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_zMx_"><div class="docsWrapper_vlUk"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_nMwe" type="button"></button><div class="docRoot_wnou"><aside class="theme-doc-sidebar-container docSidebarContainer_JrTY"><div class="sidebarViewport_wVN_"><div class="sidebar_Zo3G"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_XvAV"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_OTIz menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/pr-preview/pr-191/docs/hpc/getting_started/intro/"><span title="Getting Started" class="categoryLinkLabel_IRz3">Getting Started</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_OTIz menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/pr-preview/pr-191/docs/hpc/connecting_to_hpc/connecting_to_hpc/"><span title="Setup" class="categoryLinkLabel_IRz3">Setup</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_OTIz menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/pr-preview/pr-191/docs/hpc/storage/intro_and_data_management/"><span title="Storage &amp; Data transfers" class="categoryLinkLabel_IRz3">Storage &amp; Data transfers</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_OTIz menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/pr-preview/pr-191/docs/hpc/datasets/intro/"><span title="Datasets" class="categoryLinkLabel_IRz3">Datasets</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_OTIz menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/pr-preview/pr-191/docs/hpc/submitting_jobs/slurm_submitting_jobs/"><span title="Submitting jobs" class="categoryLinkLabel_IRz3">Submitting jobs</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_OTIz menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/pr-preview/pr-191/docs/hpc/tools_and_software/intro/"><span title="Tools &amp; Software" class="categoryLinkLabel_IRz3">Tools &amp; Software</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/pr-191/docs/hpc/tools_and_software/intro/"><span title="Start here!" class="linkLabel_RgMO">Start here!</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/pr-191/docs/hpc/tools_and_software/licensed_software/"><span title="Licensed Software" class="linkLabel_RgMO">Licensed Software</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/pr-191/docs/hpc/tools_and_software/modules/"><span title="Modules" class="linkLabel_RgMO">Modules</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/pr-191/docs/hpc/tools_and_software/python_packages_with_virtual_environments/"><span title="Python Packages with Virtual Environments" class="linkLabel_RgMO">Python Packages with Virtual Environments</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/pr-191/docs/hpc/tools_and_software/r_packages_with_renv/"><span title="R Packages with renv" class="linkLabel_RgMO">R Packages with renv</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/pr-preview/pr-191/docs/hpc/tools_and_software/conda_environments/"><span title="Conda Environments (Python, R)" class="linkLabel_RgMO">Conda Environments (Python, R)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/pr-191/docs/hpc/tools_and_software/sqlite_handling_large_structured_data/"><span title="SQLite: Handling Large Structured Data" class="linkLabel_RgMO">SQLite: Handling Large Structured Data</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_OTIz menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/pr-preview/pr-191/docs/hpc/containers/intro/"><span title="Containers" class="categoryLinkLabel_IRz3">Containers</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_OTIz menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/pr-preview/pr-191/docs/hpc/ml_ai_hpc/intro/"><span title="ML/AI on HPC" class="categoryLinkLabel_IRz3">ML/AI on HPC</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_OTIz menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/pr-preview/pr-191/docs/hpc/ood/ood_intro/"><span title="Open OnDemand (OOD)" class="categoryLinkLabel_IRz3">Open OnDemand (OOD)</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pr-preview/pr-191/docs/hpc/spec_sheet/"><span title="Torch Spec Sheet" class="linkLabel_RgMO">Torch Spec Sheet</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pr-preview/pr-191/docs/hpc/system_status/"><span title="Greene System Status" class="linkLabel_RgMO">Greene System Status</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_OTIz menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/pr-preview/pr-191/docs/hpc/tutorial_intro_shell_hpc/intro/"><span title="Tutorial: Intro to Shell for HPC" class="categoryLinkLabel_IRz3">Tutorial: Intro to Shell for HPC</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_OTIz menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/pr-preview/pr-191/docs/hpc/tutorial_intro_hpc/intro_hpc/"><span title="Tutorial: Intro to HPC" class="categoryLinkLabel_IRz3">Tutorial: Intro to HPC</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_OTIz menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/pr-preview/pr-191/docs/hpc/support/support/"><span title="Support" class="categoryLinkLabel_IRz3">Support</span></a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_KK_H"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_K3iM"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_p7J4"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol__lxn"><div class="docItemContainer_T58M"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_mYRa" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/pr-preview/pr-191/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_einq"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tools &amp; Software</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Conda Environments (Python, R)</span></li></ul></nav><div class="tocCollapsible_FsOG theme-doc-toc-mobile tocMobile_e85Q"><button type="button" class="clean-btn tocCollapsibleButton_R0hy">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Conda Environments (Python, R)</h1></header>
<div class="theme-admonition theme-admonition-tip admonition_aeex alert alert--success"><div class="admonitionHeading_LV_G"><span class="admonitionIcon_nEU7"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_vzt9"><p>This page describes how you can create conda environments without containers in <code>$SCRATCH</code>/<code>/home/$USER</code>. We strongly encourage you to create conda environments within Overlay files attached to Apptainer containers <a href="/pr-preview/pr-191/docs/hpc/containers/singularity_with_conda/">as described in this section</a>. Please note that creating both kinds of conda environments is strongly discouraged as it leads to packages from one environment being accidentally used in another.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_nzaP" id="what-is-conda">What is Conda?<a href="#what-is-conda" class="hash-link" aria-label="Direct link to What is Conda?" title="Direct link to What is Conda?" translate="no">​</a></h2>
<p>Package, dependency and environment management for any language—Python, R, Ruby, Lua, Scala, Java, JavaScript, C/ C++, FORTRAN, and more. Please find more information at <a href="https://docs.conda.io/en/latest/" target="_blank" rel="noopener noreferrer">the official documentation page</a></p>
<p>Conda provides a great way to install packages that are already compiled, so you don&#x27;t need to go over the long compilation process. If a package you need is not available, you can install it (and compile it when needed) using <code>pip</code> (Python) or <code>install.packages</code> (R).</p>
<div class="theme-admonition theme-admonition-note admonition_aeex alert alert--secondary"><div class="admonitionHeading_LV_G"><span class="admonitionIcon_nEU7"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_vzt9"><p><strong>Reproducibility</strong>:
One of the ways to ensure the reproducibility of your results is to have an independent conda environment in the directory of each project (one of the options shown below). This will also keep conda environment files away from your <code>/home/$USER</code> directory.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_nzaP" id="advantagesdisadvantages-of-using-conda">Advantages/disadvantages of using Conda<a href="#advantagesdisadvantages-of-using-conda" class="hash-link" aria-label="Direct link to Advantages/disadvantages of using Conda" title="Direct link to Advantages/disadvantages of using Conda" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_nzaP" id="advantages">Advantages<a href="#advantages" class="hash-link" aria-label="Direct link to Advantages" title="Direct link to Advantages" translate="no">​</a></h3>
<ul>
<li>A lot of pre-compiled packages (fast and easy to install)</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_aeex alert alert--secondary"><div class="admonitionHeading_LV_G"><span class="admonitionIcon_nEU7"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_vzt9"><p><strong>For Python</strong>: pip also offers pre-compiled packages (wheels). List can be found on <a href="https://pythonwheels.com" target="_blank" rel="noopener noreferrer">Python Wheels</a>.
However, Conda has a significantly larger number of pre-compiled packages.</p></div></div>
<ul>
<li>Compiled packages use highly efficient Intel Math Kernel Library (MKL) library</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_nzaP" id="disadvantages">Disadvantages<a href="#disadvantages" class="hash-link" aria-label="Direct link to Disadvantages" title="Direct link to Disadvantages" translate="no">​</a></h3>
<ul>
<li>Conda does not take advantage of packages already installed in the system (while <a href="/pr-preview/pr-191/docs/hpc/tools_and_software/python_packages_with_virtual_environments/">virtualenv and venv</a> do)</li>
<li>As you will see below, you may need to do additional steps to keep track of all installed packages (including those installed by pip and/or install.packages)</li>
</ul>
<details class="details_CECO alert alert--info details_oCvs" data-collapsed="true"><summary><p><strong>Automatic deletion of your files</strong>
Files on the <code>/scratch</code> file system that have not been accessed for 60 or more days will be purged (see <a href="/pr-preview/pr-191/docs/hpc/storage/intro_and_data_management/">HPC Storage</a> for details). Click to see how you can work around this limitation.</p></summary><div><div class="collapsibleContent_c3NZ"><div class="theme-admonition theme-admonition-tip admonition_aeex alert alert--success"><div class="admonitionHeading_LV_G"><span class="admonitionIcon_nEU7"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_vzt9"><p>Thus you can consider the following options:</p><ul>
<li>Reinstall your packages if some of the files get deleted<!-- -->
<ul>
<li>You can do this manually</li>
<li>You can do this automatically. For example, within a workflow of a pipeline software like <a href="https://www.nextflow.io/" target="_blank" rel="noopener noreferrer">Nextflow</a></li>
</ul>
</li>
<li>Pay for &quot;Research Project Space&quot; - for details see <a href="/pr-preview/pr-191/docs/hpc/storage/research_project_space/">Research Project Space</a></li>
<li>Use Singularity and install packages within a corresponding overlay file - Details available at <a href="/pr-preview/pr-191/docs/hpc/containers/squash_file_system_and_singularity/">Squash File System and Singularity</a></li>
</ul></div></div></div></div></details>
<h2 class="anchor anchorWithStickyNavbar_nzaP" id="initializing-conda">Initializing Conda<a href="#initializing-conda" class="hash-link" aria-label="Direct link to Initializing Conda" title="Direct link to Initializing Conda" translate="no">​</a></h2>
<p>Load anaconda module</p>
<div class="language-sh codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-sh codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module purge</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module load anaconda3/2024.02</span><br></span></code></pre></div></div>
<p>Conda init can create problems with package installation, so we suggest using <code>source activate</code> instead of <code>conda activate</code>, even though conda activate is considered a best practice by the Anaconda developers.</p>
<p>There are two main ways to create conda environments.  You can either define them with a name by using the <code>-n</code> or <code>--name</code> parameter or you can define them by full path (or prefix) using the <code>-p</code> or <code>--prefix</code> parameter.</p>
<div class="theme-admonition theme-admonition-tip admonition_aeex alert alert--success"><div class="admonitionHeading_LV_G"><span class="admonitionIcon_nEU7"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_vzt9"><p>NYU HPC recommends using prefix environments as a best practice because it makes reproducibility easier as we will see below.  However, we do show how to use named environments with your <code>/scratch</code> space, so you don&#x27;t fill up your <code>/home</code> space, if that&#x27;s preferred.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_nzaP" id="prefix-conda-environments">Prefix Conda Environments<a href="#prefix-conda-environments" class="hash-link" aria-label="Direct link to Prefix Conda Environments" title="Direct link to Prefix Conda Environments" translate="no">​</a></h2>
<p>You can store your program/project in <code>/scratch</code> and keep the conda environment with it by using the <code>-p</code> parameter. This will keep all the files inside the project&#x27;s directory, instead of putting in in your <code>/home/$USER</code>. <br>
Here are details about how to do this for Python and R projects:</p>
<h3 class="anchor anchorWithStickyNavbar_nzaP" id="python">Python<a href="#python" class="hash-link" aria-label="Direct link to Python" title="Direct link to Python" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_nzaP" id="1-load-anaconda-module-and-create-local-prefix-environment">1. Load anaconda module and create local prefix environment<a href="#1-load-anaconda-module-and-create-local-prefix-environment" class="hash-link" aria-label="Direct link to 1. Load anaconda module and create local prefix environment" title="Direct link to 1. Load anaconda module and create local prefix environment" translate="no">​</a></h4>
<div class="language-sh codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-sh codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module purge</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module load anaconda3/2024.02</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda create </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./penv python  </span><span class="token comment" style="color:hsl(230, 4%, 64%)">## environment will be created in project directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> activate ./penv </span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_nzaP" id="2-create-a-symbolic-link-so-conda-will-download-files-for-packages-to-be-installed-into-scratch-not-your-home-directory">2. Create a symbolic link so conda will download files for packages to be installed into scratch, not your home directory.<a href="#2-create-a-symbolic-link-so-conda-will-download-files-for-packages-to-be-installed-into-scratch-not-your-home-directory" class="hash-link" aria-label="Direct link to 2. Create a symbolic link so conda will download files for packages to be installed into scratch, not your home directory." title="Direct link to 2. Create a symbolic link so conda will download files for packages to be installed into scratch, not your home directory." translate="no">​</a></h4>
<div class="language-sh codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-sh codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> /home/</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">NetID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/.conda</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> /scratch/</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">NetID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/conda_pkgs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-s</span><span class="token plain"> /scratch/</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">NetID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/conda_pkgs /home/</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">NetID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/.conda/pkgs</span><br></span></code></pre></div></div>
<p><a href="https://anaconda.org/anaconda/repo" target="_blank" rel="noopener noreferrer">Install pre-compiled packages available in conda</a></p>
<div class="language-sh codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-sh codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> anaconda pandas</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_nzaP" id="3-other-packages-may-be-installed-and-compiled-when-needed-using-pip">3. Other packages may be installed (and compiled when needed) using pip<a href="#3-other-packages-may-be-installed-and-compiled-when-needed-using-pip" class="hash-link" aria-label="Direct link to 3. Other packages may be installed (and compiled when needed) using pip" title="Direct link to 3. Other packages may be installed (and compiled when needed) using pip" translate="no">​</a></h4>
<div class="language-sh codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-sh codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pip </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">package_name</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_aeex alert alert--secondary"><div class="admonitionHeading_LV_G"><span class="admonitionIcon_nEU7"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_vzt9"><p>Conda and packages install by default to <code>~/.local/lib/python&lt;version&gt;</code>, so if you did use <code>&#x27;pip install --user&#x27;</code> to install some packages (without conda or other virtual environment), they will be available in <code>~/.local/lib/python&lt;version&gt;</code></p></div></div>
<div class="theme-admonition theme-admonition-warning admonition_aeex alert alert--warning"><div class="admonitionHeading_LV_G"><span class="admonitionIcon_nEU7"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_vzt9"><div class="theme-admonition theme-admonition-info admonition_aeex alert alert--info"><div class="admonitionHeading_LV_G"><span class="admonitionIcon_nEU7"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>The primary takeaway:</div><div class="admonitionContent_vzt9"><p>Let say you have tornado v.6 installed in <code>~/.local/lib/python&lt;version&gt;</code>, and tornado v.5 installed by <code>conda install</code>.</p><p>When you will do <code>source activate</code> you will have tornado v.6 available!! Not v.5!!</p><p>(this behaviour is the same for packages installed by to <code>~/.local/lib/python&lt;version&gt;</code> before or after you create your conda environment)</p><p><code>pip freeze</code> will give v.6</p><p><code>conda list</code> will give v.5</p></div></div><div class="theme-admonition theme-admonition-tip admonition_aeex alert alert--success"><div class="admonitionHeading_LV_G"><span class="admonitionIcon_nEU7"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Solution</div><div class="admonitionContent_vzt9"><p>To overcome this, do <code>export PYTHONNOUSERSITE=True</code> after source activate</p></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_nzaP" id="r">R<a href="#r" class="hash-link" aria-label="Direct link to R" title="Direct link to R" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_nzaP" id="1-load-anaconda-module-and-create-local-prefix-environment-1">1. Load anaconda module and create local prefix environment<a href="#1-load-anaconda-module-and-create-local-prefix-environment-1" class="hash-link" aria-label="Direct link to 1. Load anaconda module and create local prefix environment" title="Direct link to 1. Load anaconda module and create local prefix environment" translate="no">​</a></h4>
<div class="language-sh codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-sh codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module load anaconda3/2024.02</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda create </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./renv </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">r</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3.5</span><span class="token plain"> </span><span class="token comment" style="color:hsl(230, 4%, 64%)">## environment will be created in project directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">## OR</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda create </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> conda-forge </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./renv r-base</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3.6</span><span class="token plain">.3 </span><span class="token comment" style="color:hsl(230, 4%, 64%)">## environment will be created in project directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> activate ./renv</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_nzaP" id="2-install-pre-compiled-packages-available-in-conda">2. Install pre-compiled packages available in conda:<a href="#2-install-pre-compiled-packages-available-in-conda" class="hash-link" aria-label="Direct link to 2. Install pre-compiled packages available in conda:" title="Direct link to 2. Install pre-compiled packages available in conda:" translate="no">​</a></h4>
<p><a href="https://docs.anaconda.com/anaconda/packages/r-language-pkg-docs/" target="_blank" rel="noopener noreferrer">https://docs.anaconda.com/anaconda/packages/r-language-pkg-docs/</a></p>
<div class="language-sh codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-sh codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> r r-dplyr</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_nzaP" id="3-other-packages-may-be-installed-and-compiled-using-installpackages">3. Other packages may be installed (and compiled) using install.packages()<a href="#3-other-packages-may-be-installed-and-compiled-using-installpackages" class="hash-link" aria-label="Direct link to 3. Other packages may be installed (and compiled) using install.packages()" title="Direct link to 3. Other packages may be installed (and compiled) using install.packages()" translate="no">​</a></h4>
<div class="language-sh codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-sh codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">install.packages</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&lt;package_name&gt;&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_nzaP" id="named-conda-environments">Named Conda Environments<a href="#named-conda-environments" class="hash-link" aria-label="Direct link to Named Conda Environments" title="Direct link to Named Conda Environments" translate="no">​</a></h2>
<p>You can create a named conda environment with a command like:</p>
<div class="language-bash codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-bash codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda create </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--name</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">my-env</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><br></span></code></pre></div></div>
<p>You&#x27;ll need to replace <code>&lt;my-env&gt;</code> with the name of your environment.</p>
<p>We defined where the prefix environment is created in the creation command, so where is the named environment created for named conda environments?</p>
<p>We can find this out by using the <code>info</code> command with conda:</p>
<div class="language-bash codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-bash codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">$ conda info</span><br></span></code></pre></div></div>
<p>This should output something like:</p>
<div class="language-bash codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-bash codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     active environment </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> None</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">       user config </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> /home/NetID/.condarc</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> populated config files </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          conda version </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">24.1</span><span class="token plain">.2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    conda-build version </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">24.1</span><span class="token plain">.2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">         python version </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3.11</span><span class="token plain">.7.final.0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 solver </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> libmamba </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">default</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">       virtual packages </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">__archspec</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">cascadelake</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                          </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">__conda</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">24.1</span><span class="token plain">.2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                          </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">__glibc</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2.34</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                          </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">__linux</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">5.14</span><span class="token plain">.0</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                          </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">__unix</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">       base environment </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> /share/apps/anaconda3/2024.02  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">read only</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      conda av data </span><span class="token function" style="color:hsl(221, 87%, 60%)">dir</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> /share/apps/anaconda3/2024.02/etc/conda</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  conda av metadata url </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> None</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">           channel URLs </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> https://repo.anaconda.com/pkgs/main/linux-64</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                          https://repo.anaconda.com/pkgs/main/noarch</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                          https://repo.anaconda.com/pkgs/r/linux-64</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                          https://repo.anaconda.com/pkgs/r/noarch</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          package cache </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> /share/apps/anaconda3/2024.02/pkgs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                          /home/NetID/.conda/pkgs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">       envs directories </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> /home/NetID/.conda/envs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                          /share/apps/anaconda3/2024.02/envs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">               platform </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> linux-64</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">             user-agent </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> conda/24.1.2 requests/2.31.0 CPython/3.11.7 Linux/5.14.0-284.86.1.el9_2.x86_64 rhel/9.2 glibc/2.34 solver/libmamba conda-libmamba-solver/24.1.0 libmambapy/1.5.6 aau/0.4.3 c/U4Vmh2Rw4idTcwqzLhNX1g s/2MYchdSIR4EFcYeOthelfQ</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">UID</span><span class="token plain">:GID </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">402570</span><span class="token plain">:402570</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">             netrc </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> None</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">           offline mode </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> False</span><br></span></code></pre></div></div>
<p>You can see in this output the default location for your <code>package cache</code> and your <code>envs directories</code>.  They&#x27;re currently set to subdirectories of our home directory.  If we create named environments with these setting we will very quickly fill up our limited home directory space.  The solution to this is to create or modify our personal conda config file to change these settings.  You can see the setting above for <code>user config file</code> tells us the location of the file where we can make changes to these defaults.  If the file doesn&#x27;t exist you&#x27;ll need to create it.  You may also need to change the config file location if your output from <code>conda info</code> differs from the above.</p>
<div class="language-bash codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-bash codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">$ </span><span class="token function" style="color:hsl(221, 87%, 60%)">nano</span><span class="token plain"> /home/NetID/.condarc</span><br></span></code></pre></div></div>
<p>Now add the following lines to your config file:</p>
<div class="language-bash codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-bash codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">envs_dirs:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  - /scratch/NetID/conda_envs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pkgs_dirs:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  - /scratch/NetID/conda_pkgs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">always_copy: </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><br></span></code></pre></div></div>
<p>You&#x27;ll need to create those directories if they don&#x27;t exist:</p>
<div class="language-bash codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-bash codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">$ </span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> /scratch/NetID/conda_envs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">$ </span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> /scratch/NetID/conda_pkgs</span><br></span></code></pre></div></div>
<p>Don&#x27;t forget to change <code>NetID</code> above to your <code>NetID</code>.</p>
<p>You should now see that the <code>package cache</code> and <code>envs directories</code> entries have changed to your <code>/scratch</code> space when you run <code>conda info</code> and packages and environments will be saved on your <code>/scratch</code> space for all named conda environments.</p>
<h2 class="anchor anchorWithStickyNavbar_nzaP" id="reproducibility">Reproducibility<a href="#reproducibility" class="hash-link" aria-label="Direct link to Reproducibility" title="Direct link to Reproducibility" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_nzaP" id="packages-installed-only-using-conda">Packages installed only using conda<a href="#packages-installed-only-using-conda" class="hash-link" aria-label="Direct link to Packages installed only using conda" title="Direct link to Packages installed only using conda" translate="no">​</a></h3>
<p>Save a list of packages (so you are able to report the environment in a publication, and to restore/reproduce the environment on another machine at any time)</p>
<div class="language-bash codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-bash codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># save</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda list </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--export</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> requirements.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># restore</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda create </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./penv </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--file</span><span class="token plain"> requirements.txt</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_aeex alert alert--secondary"><div class="admonitionHeading_LV_G"><span class="admonitionIcon_nEU7"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_vzt9"><p>This will not list packages installed by <code>pip</code> or <code>install.packages()</code></p></div></div>
<h3 class="anchor anchorWithStickyNavbar_nzaP" id="packages-installed-using-conda-and-pip-python">Packages installed using conda and <code>pip</code> (Python)<a href="#packages-installed-using-conda-and-pip-python" class="hash-link" aria-label="Direct link to packages-installed-using-conda-and-pip-python" title="Direct link to packages-installed-using-conda-and-pip-python" translate="no">​</a></h3>
<p>In this case you can use:</p>
<div class="language-bash codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-bash codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PYTHONNOUSERSITE</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">True  </span><span class="token comment" style="color:hsl(230, 4%, 64%)">## to ignore packages in ~/.local/lib/python&lt;version&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># save</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda list </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--export</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> conda_requirements.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pip freeze </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> pip_requirements.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># restore</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda create </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./penv </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--file</span><span class="token plain"> conda_requirements.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pip </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-r</span><span class="token plain"> pip_requirements.txt</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_aeex alert alert--success"><div class="admonitionHeading_LV_G"><span class="admonitionIcon_nEU7"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_vzt9"><p>Alternatively, you can use <code>conda env export &gt; all_requirements.txt</code>, which will save both: packages installed by conda and <code>pip</code>.</p><div class="theme-admonition theme-admonition-warning admonition_aeex alert alert--warning"><div class="admonitionHeading_LV_G"><span class="admonitionIcon_nEU7"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_vzt9"><p>However, this may fail if your conda environment is created as a sub-directory of your project&#x27;s directory (which we recommend)</p></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_nzaP" id="packages-installed-using-installpackages-r">Packages installed using <code>install.packages</code> (R)<a href="#packages-installed-using-installpackages-r" class="hash-link" aria-label="Direct link to packages-installed-using-installpackages-r" title="Direct link to packages-installed-using-installpackages-r" translate="no">​</a></h3>
<p>The command <code>conda list --export</code> will not include packages installed by <code>install.packages</code>. So, only use <code>conda install</code> to install R and use <code>renv</code> to maintain information about packages installed by <code>install.packages</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_nzaP" id="renv"><code>renv</code><a href="#renv" class="hash-link" aria-label="Direct link to renv" title="Direct link to renv" translate="no">​</a></h4>
<p>Please see details of using <code>renv</code> with conda for reproducibilty on <a href="/pr-preview/pr-191/docs/hpc/tools_and_software/r_packages_with_renv/">R packages with <code>renv</code></a>.</p>
<h2 class="anchor anchorWithStickyNavbar_nzaP" id="use-conda-env-in-a-batch-script">Use conda env in a batch script<a href="#use-conda-env-in-a-batch-script" class="hash-link" aria-label="Direct link to Use conda env in a batch script" title="Direct link to Use conda env in a batch script" translate="no">​</a></h2>
<p>The part of the batch script that will call the command should look like:</p>
<h3 class="anchor anchorWithStickyNavbar_nzaP" id="python-1">Python<a href="#python-1" class="hash-link" aria-label="Direct link to Python" title="Direct link to Python" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_nzaP" id="single-node">Single node<a href="#single-node" class="hash-link" aria-label="Direct link to Single node" title="Direct link to Single node" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-bash codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --job-name=test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --nodes=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --cpus-per-task=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --ntasks-per-node=4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --mem=8GB</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --time=1:00:00</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module purge</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module load anaconda3/2024.02</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">OMP_NUM_THREADS</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$SLURM_CPUS_PER_TASK</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> /share/apps/anaconda3/2020.07/etc/profile.d/conda.sh</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PATH_TO_ENV</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">full path to penv</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> activate </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$PATH_TO_ENV</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:hsl(35, 99%, 36%)">PATH</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$PATH_TO_ENV</span><span class="token plain">/bin:</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$PATH</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">python test.py</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>You&#x27;ll need to replace <code>&lt;full path to penv&gt;</code> with the full path to your penv directory.  It&#x27;s probably something like <code>/scratch/NetID/conda_tests/penv</code></p>
<h4 class="anchor anchorWithStickyNavbar_nzaP" id="multiple-nodes-using-mpi">Multiple nodes, using MPI<a href="#multiple-nodes-using-mpi" class="hash-link" aria-label="Direct link to Multiple nodes, using MPI" title="Direct link to Multiple nodes, using MPI" translate="no">​</a></h4>
<div class="language-sh codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-sh codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --job-name=test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --nodes=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --cpus-per-task=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --ntasks-per-node=4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --mem=8GB</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --time=1:00:00</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PATH_TO_ENV</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&lt;full path to penv&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module purge</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module load openmpi/gcc/4.1.6</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">mpiexec </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;module purge;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">export OMP_NUM_THREADS=</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$SLURM_CPUS_PER_TASK</span><span class="token string" style="color:hsl(119, 34%, 47%)">;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">module load anaconda3/2024.02;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">source /share/apps/anaconda3/2024.02/etc/profile.d/conda.sh;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">source activate &quot;</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$PATH_TO_ENV</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">export PATH=&quot;</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$PATH_TO_ENV</span><span class="token plain">/bin:</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$PATH</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">python test.py&quot;</span><br></span></code></pre></div></div>
<p>Again, you&#x27;ll need to replace <code>&lt;full path to penv&gt;</code> above with the full path to your penv directory.</p>
<h3 class="anchor anchorWithStickyNavbar_nzaP" id="r-conda-packages-only">R (conda packages only)<a href="#r-conda-packages-only" class="hash-link" aria-label="Direct link to R (conda packages only)" title="Direct link to R (conda packages only)" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-bash codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --job-name=test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --nodes=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --cpus-per-task=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --ntasks-per-node=4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --mem=8GB</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --time=1:00:00</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module purge</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module load anaconda3/2024.02</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">OMP_NUM_THREADS</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$SLURM_CPUS_PER_TASK</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> /share/apps/anaconda3/2024.02/etc/profile.d/conda.sh</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PATH_TO_ENV</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">full path to renv</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> activate </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$PATH_TO_ENV</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:hsl(35, 99%, 36%)">PATH</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$PATH_TO_ENV</span><span class="token plain">/bin:</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$PATH</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Rscript r_script.R</span><br></span></code></pre></div></div>
<p>You&#x27;ll again need to replace <code>&lt;full path to renv&gt;</code> above with the full path to your renv directory.</p>
<h4 class="anchor anchorWithStickyNavbar_nzaP" id="multiple-nodes-using-mpi-1">Multiple nodes, using MPI<a href="#multiple-nodes-using-mpi-1" class="hash-link" aria-label="Direct link to Multiple nodes, using MPI" title="Direct link to Multiple nodes, using MPI" translate="no">​</a></h4>
<div class="language-sh codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-sh codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --job-name=test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --nodes=2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --cpus-per-task=2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --ntasks-per-node=4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --mem=8GB</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --time=1:00:00</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module purge</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module load anaconda3/2024.02</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">OMP_NUM_THREADS</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$SLURM_CPUS_PER_TASK</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> /share/apps/anaconda3/2024.02/etc/profile.d/conda.sh</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PATH_TO_ENV</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&lt;full path to renv&gt;&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> activate </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$PATH_TO_ENV</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:hsl(35, 99%, 36%)">PATH</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$PATH_TO_ENV</span><span class="token plain">/bin:</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$PATH</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Rscript test.R</span><br></span></code></pre></div></div>
<p>You&#x27;ll again need to replace <code>&lt;full path to renv&gt;</code> above with the full path to your renv directory.</p>
<h3 class="anchor anchorWithStickyNavbar_nzaP" id="r-conda-with-renv-combination">R (conda with renv combination)<a href="#r-conda-with-renv-combination" class="hash-link" aria-label="Direct link to R (conda with renv combination)" title="Direct link to R (conda with renv combination)" translate="no">​</a></h3>
<p>In this case, when you use sbatch you would activate conda in sbatch script, and R script will pickup packages installed in renv</p>
<div class="language-sh codeBlockContainer_Gtvh theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_q3dc"><pre tabindex="0" class="prism-code language-sh codeBlock_ggay thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_Y19p"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --job-name=test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --nodes=2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --cpus-per-task=2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --ntasks-per-node=4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --mem=8GB</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --time=1:00:00module purge</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module load anaconda3/2024.02</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> /share/apps/anaconda3/2024.02/etc/profile.d/conda.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> activate </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">full path to renv</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Rscript test.R</span><br></span></code></pre></div></div>
<p>You&#x27;ll again need to replace <code>&lt;full path to renv&gt;</code> above with the full path to your renv directory.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/NYU-RTS/rts-docs/blob/main/docs/hpc/06_tools_and_software/06_conda_environments.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_liBE" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_si7g"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/pr-preview/pr-191/docs/hpc/tools_and_software/r_packages_with_renv/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">R Packages with renv</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/pr-preview/pr-191/docs/hpc/tools_and_software/sqlite_handling_large_structured_data/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">SQLite: Handling Large Structured Data</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_CFJu thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-conda" class="table-of-contents__link toc-highlight">What is Conda?</a></li><li><a href="#advantagesdisadvantages-of-using-conda" class="table-of-contents__link toc-highlight">Advantages/disadvantages of using Conda</a><ul><li><a href="#advantages" class="table-of-contents__link toc-highlight">Advantages</a></li><li><a href="#disadvantages" class="table-of-contents__link toc-highlight">Disadvantages</a></li></ul></li><li><a href="#initializing-conda" class="table-of-contents__link toc-highlight">Initializing Conda</a></li><li><a href="#prefix-conda-environments" class="table-of-contents__link toc-highlight">Prefix Conda Environments</a><ul><li><a href="#python" class="table-of-contents__link toc-highlight">Python</a></li><li><a href="#r" class="table-of-contents__link toc-highlight">R</a></li></ul></li><li><a href="#named-conda-environments" class="table-of-contents__link toc-highlight">Named Conda Environments</a></li><li><a href="#reproducibility" class="table-of-contents__link toc-highlight">Reproducibility</a><ul><li><a href="#packages-installed-only-using-conda" class="table-of-contents__link toc-highlight">Packages installed only using conda</a></li><li><a href="#packages-installed-using-conda-and-pip-python" class="table-of-contents__link toc-highlight">Packages installed using conda and <code>pip</code> (Python)</a></li><li><a href="#packages-installed-using-installpackages-r" class="table-of-contents__link toc-highlight">Packages installed using <code>install.packages</code> (R)</a></li></ul></li><li><a href="#use-conda-env-in-a-batch-script" class="table-of-contents__link toc-highlight">Use conda env in a batch script</a><ul><li><a href="#python-1" class="table-of-contents__link toc-highlight">Python</a></li><li><a href="#r-conda-packages-only" class="table-of-contents__link toc-highlight">R (conda packages only)</a></li><li><a href="#r-conda-with-renv-combination" class="table-of-contents__link toc-highlight">R (conda with renv combination)</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Contact</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:hpc@nyu.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email HPC support<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_i9eD"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:hsrn-support@nyu.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email HSRN support<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_i9eD"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:research-cloud-support@nyu.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email Research Cloud support<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_i9eD"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:srde-support@nyu.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email Secure Research Data Environment support<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_i9eD"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:genai-support@nyu.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email general GenAI support<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_i9eD"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:genai-research-support@nyu.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email GenAI for research support<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_i9eD"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://guides.nyu.edu/" target="_blank" rel="noopener noreferrer" class="footer__link-item">NYU Libraries Research Guides<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_i9eD"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://sites.google.com/nyu.edu/forc-camp/home" target="_blank" rel="noopener noreferrer" class="footer__link-item">FORC camp<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_i9eD"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.google.com/forms/d/e/1FAIpQLSeHnmkPdR_IvWnT6a7U_V3RpfmQrpS8hjxI11FNnsZMlrBa4g/viewform" target="_blank" rel="noopener noreferrer" class="footer__link-item">Feedback</a></li><li class="footer__item"><a class="footer__link-item" href="/pr-preview/pr-191/blog/">Announcements</a></li><li class="footer__item"><a href="https://github.com/NYU-RTS/rts-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_i9eD"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Made with 💜 in NYC!</div></div></div></footer></div>
</body>
</html>