"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9533],{8219:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"hpc/containers/containers","title":"Using Containers on HPC","description":"A container is a lightweight, standalone, executable package of software that includes everything needed to run an application like code, runtime, system tools, system libraries etc.","source":"@site/docs/hpc/07_containers/02_containers.mdx","sourceDirName":"hpc/07_containers","slug":"/hpc/containers/containers","permalink":"/rts-docs-dev/pr-preview/pr-78/docs/hpc/containers/containers","draft":false,"unlisted":false,"editUrl":"https://github.com/NYU-ITS/rts-docs-dev/blob/main/docs/hpc/07_containers/02_containers.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"hpcSidebar","previous":{"title":"Apptainer/Singularity","permalink":"/rts-docs-dev/pr-preview/pr-78/docs/hpc/containers/intro"},"next":{"title":"Singularity with Conda","permalink":"/rts-docs-dev/pr-preview/pr-78/docs/hpc/containers/singularity_with_conda"}}');var t=s(5105),r=s(3881);const a={},o="Using Containers on HPC",l={},c=[{value:"Key features include",id:"key-features-include",level:3},{value:"Why Apptainer",id:"why-apptainer",level:2},{value:"How to use Apptainer on NYU HPC",id:"how-to-use-apptainer-on-nyu-hpc",level:2},{value:"Overlay filesystems",id:"overlay-filesystems",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"using-containers-on-hpc",children:"Using Containers on HPC"})}),"\n",(0,t.jsxs)(n.p,{children:["A container is a ",(0,t.jsx)(n.em,{children:"lightweight"}),", ",(0,t.jsx)(n.em,{children:"standalone"}),", executable package of software that includes everything needed to run an application like code, runtime, system tools, system libraries etc."]}),"\n",(0,t.jsx)(n.h3,{id:"key-features-include",children:"Key features include"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Portability"})," :  Consistent environment across different systems."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Isolation"})," : Encapsulates applications to prevent interference with other applications in the host systems."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Efficiency"})," : They share the same OS Kernel and uses system resources more efficiently than virtualization."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["There are many Containerization tools out there, the most popular being ",(0,t.jsx)(n.strong,{children:"docker"}),", and most of them conform to the ",(0,t.jsx)(n.a,{href:"https://opencontainers.org/",children:(0,t.jsx)(n.strong,{children:"Open Container Initiative (OCI)"})})," that is an industry standard for container formats."]}),"\n",(0,t.jsxs)(n.p,{children:["An opensource containerization tool called ",(0,t.jsx)(n.a,{href:"https://apptainer.org/",children:(0,t.jsx)(n.strong,{children:"Aptainer"})})," is used over docker to package performant critical software on HPC Systems."]}),"\n",(0,t.jsx)(n.h2,{id:"why-apptainer",children:"Why Apptainer"}),"\n",(0,t.jsx)(n.p,{children:"Apptainer is an open source container platform designed to be simple, fast, and secure. Many container platforms are available, but Apptainer is designed for ease-of-use on shared systems and in high performance computing (HPC) environments. It is preferred over docker for serveral reasons that are:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Safety and Mobility"})," : It provides an immutable single-file container image format, supporting cryptographic signatures and encryption. Enabling portability and reproducibility of research works."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Integration over isolation"})," : It is specifically designed to utilize GPUs, high speed networks, parallel filesystems on a cluster, emphasizing integration over isolation."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Security"})," : Apptainer runs as a deamonless process that is designed to be more secure for use on clusters shared by 100s or 1000s of users."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"how-to-use-apptainer-on-nyu-hpc",children:"How to use Apptainer on NYU HPC"}),"\n",(0,t.jsx)(n.p,{children:"Since docker and apptainer conform to the OCI standards, we can pull in images packaged with docker using apptainer on the HPC from docker hub. For example running the command,"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"apptainer pull docker://python\n"})}),"\n",(0,t.jsxs)(n.p,{children:["will pull in a latest python image from docker hub and saves it as a single file with an ",(0,t.jsx)(n.code,{children:".sif"})," file extension in the current working directory, this file format is called ",(0,t.jsx)(n.strong,{children:"singularity file format"}),". We use this image file to spawn containers with apptainer or singularity ( an older version of apptainer )."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"[pp2959@log-3 ~]$ ls\npython_latest.sif\n[pp2959@log-3 ~]$\n"})}),"\n",(0,t.jsx)(n.p,{children:"We can spawn or run a container from this image like,"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"apptainer run python_latest.sif python3\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'[pp2959@log-3 rts-docs]$ apptainer run python_latest.sif python3\nPython 3.13.3 (main, Apr  9 2025, 00:27:54) [GCC 12.2.0] on linux\nType "help", "copyright", "credits" or "license" for more information.\n>>>\n>>> print("hello there !")\nhello there !\n>>> exit()\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Many pre-built singualrity images are available on the cluster at the location ",(0,t.jsx)(n.code,{children:"/scratch/work/public/singularity/"}),", to view all available image files run:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"ls /scratch/work/public/singularity/*.sif\n"})}),"\n",(0,t.jsx)(n.p,{children:"To run an interactive bash shell within a container, try:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"apptainer exec python_latest.sif /bin/bash\n"})}),"\n",(0,t.jsxs)(n.p,{children:["And this will return a bash shell running inside a new container spawned from ",(0,t.jsx)(n.code,{children:"python_latest.sif"}),' image file, with a default prompt "Apptainer" as shown:']}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"[pp2959@log-3 rts-docs]$ apptainer exec python_latest.sif /bin/bash\nApptainer>\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["An ",(0,t.jsx)(n.strong,{children:"Image"})," is a snapshot of a container saved in disk."]}),"\n",(0,t.jsxs)(n.li,{children:["A ",(0,t.jsx)(n.strong,{children:"Container"})," is a spawned instance of an image that runs in the background."]}),"\n"]})}),"\n",(0,t.jsx)(n.p,{children:"Containers are isolated. However, we get shared file-systems mounted with spawned containers by default on the HPC. This way we have access to the following filesystems from within our containers:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["/home/",(0,t.jsx)(n.strong,{children:"<NET_ID>"})]}),"\n",(0,t.jsxs)(n.li,{children:["/scratch/",(0,t.jsx)(n.strong,{children:"<ALL_NET_IDs>"})]}),"\n",(0,t.jsxs)(n.li,{children:["/vast/",(0,t.jsx)(n.strong,{children:"<ALL_NET_IDs>"})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["And in addition to some of the system directories. However, we will not have access to the ",(0,t.jsx)(n.code,{children:"/archive"})," filesystem from within."]}),"\n",(0,t.jsx)(n.h2,{id:"overlay-filesystems",children:"Overlay filesystems"}),"\n",(0,t.jsxs)(n.p,{children:["Images are ",(0,t.jsx)(n.code,{children:"read-only"}),". We can run containers from a SIF image file on the HPC however they are read-only. That means we can make use of containers but cannot make changes to them at runtime, like creating new directories, downloading pacakges, installing software etc."]}),"\n",(0,t.jsxs)(n.p,{children:["In-order to make changes, like to install a new software within our containers, we need to mount a ",(0,t.jsx)(n.strong,{children:"virtual filesystem"})," ( virtual disk ) along with it called ",(0,t.jsx)(n.strong,{children:"overlays"})," and install packages in it."]}),"\n",(0,t.jsx)(n.p,{children:"An overlay is like a virtual disk that can be mounted along with containers to provide storage capabilities for installing applications."}),"\n",(0,t.jsx)(n.p,{children:"They are just files similar to the SIF image files, they are:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Compressible to a single file"}),"\n",(0,t.jsx)(n.li,{children:"Portable and"}),"\n",(0,t.jsx)(n.li,{children:"Mountable with different containers"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["To use an overlay file first we must fetch it from the location ",(0,t.jsx)(n.code,{children:"/scratch/work/public/overlay-fs-ext3/"})," and decompress it using ",(0,t.jsx)(n.code,{children:"gunzip"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"cp /scratch/work/public/overlay-fs-ext3/overlay-2GB-100K.ext3.gz .\ngunzip overlay-2GB-100K.ext3.gz\n"})}),"\n",(0,t.jsx)(n.p,{children:"Now we can mount this empty overlay filesystem with our container as:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"apptainer exec --overlay overlay-2GB-100K.ext3:rw /scratch/work/public/singularity/cuda12.6.3-cudnn9.5.1-ubuntu22.04.5.sif /bin/bash\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Here we run a ubuntu container with cuda installed and mount the 2GB overlay file using the ",(0,t.jsx)(n.code,{children:"--overlay"})," flag."]}),"\n",(0,t.jsxs)(n.p,{children:["Once within the container shell, notice the ",(0,t.jsx)(n.code,{children:"/ext3"})," directory."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"cd /ext3\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"/ext3"})," directory our overlay mounted filesystem with 2GB storage that can be used as a space to save data, install packages and software, etc."]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["Use the ",(0,t.jsx)(n.code,{children:"read-write"})," tag to give your container read-write permission to a mounted overlay at ",(0,t.jsx)(n.code,{children:"/ext3"}),"."]})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{style:{textAlign:"center"},children:"Tag"}),(0,t.jsx)(n.th,{style:{textAlign:"center"},children:"Permission type"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"center"},children:(0,t.jsx)(n.strong,{children:":rw"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"Read and Write permissions"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"center"},children:(0,t.jsx)(n.strong,{children:":ro"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"Read only permissions"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["To use a GPU from within containers we need to pass over the drivers using ",(0,t.jsx)(n.code,{children:"--nv"})," argument with a apptainer command like :"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"apptainer exec --nv --overlay <PATH_TO_OVERLAY_FILE>:rw <PATH_TO_SIF_FILE> /bin/bash\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Here is an example on ",(0,t.jsx)(n.a,{href:"https://hpc.nyu.edu/hpc-systems/greene/software/singularity-with-miniconda#h.khwf3zrcxqth",children:"how to install miniconda at /ext3 directory"}),", in the overlay filesystem."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},3881:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var i=s(8101);const t={},r=i.createContext(t);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);