"use strict";(self.webpackChunkrts_docs_dev=self.webpackChunkrts_docs_dev||[]).push([["2032"],{68523:function(e,t,n){n.r(t),n.d(t,{frontMatter:()=>l,default:()=>h,toc:()=>d,metadata:()=>i,assets:()=>o,contentTitle:()=>r});var i=JSON.parse('{"id":"hpc/tools_and_software/sqlite_handling_large_structured_data","title":"SQLite: Handling Large Structured Data","description":"Overview","source":"@site/docs/hpc/06_tools_and_software/07_sqlite_handling_large_structured_data.md","sourceDirName":"hpc/06_tools_and_software","slug":"/hpc/tools_and_software/sqlite_handling_large_structured_data","permalink":"/rts-docs-dev/pr-preview/pr-120/docs/hpc/tools_and_software/sqlite_handling_large_structured_data","draft":false,"unlisted":false,"editUrl":"https://github.com/NYU-ITS/rts-docs-dev/blob/main/docs/hpc/06_tools_and_software/07_sqlite_handling_large_structured_data.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{},"sidebar":"hpcSidebar","previous":{"title":"Singularity: Run Custom Applications with Containers","permalink":"/rts-docs-dev/pr-preview/pr-120/docs/hpc/tools_and_software/singularity_run_custom_applications_with_containers"},"next":{"title":"Apptainer/Singularity","permalink":"/rts-docs-dev/pr-preview/pr-120/docs/hpc/containers/intro"}}'),s=n(74132),a=n(89447);let l={},r="SQLite: Handling Large Structured Data",o={},d=[{value:"Overview",id:"overview",level:2},{value:"Some use-cases",id:"some-use-cases",level:3},{value:"Benefits:",id:"benefits",level:3},{value:"Major benefits of SQLite compared to MySQL (PostgreSQL, etc)",id:"major-benefits-of-sqlite-compared-to-mysql-postgresql-etc",level:3},{value:"Limits",id:"limits",level:3},{value:"Command line (CLI) example",id:"command-line-cli-example",level:2},{value:"R example",id:"r-example",level:2},{value:"Install",id:"install",level:3},{value:"Use",id:"use",level:3},{value:"Alternative: read csv file to SQLite directly",id:"alternative-read-csv-file-to-sqlite-directly",level:3},{value:"UI for SQLite - SQLiteStudio",id:"ui-for-sqlite---sqlitestudio",level:2}];function c(e){let t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"sqlite-handling-large-structured-data",children:"SQLite: Handling Large Structured Data"})}),"\n",(0,s.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(t.p,{children:["Storing your data in the ",(0,s.jsx)(t.a,{href:"https://www.sqlite.org/index.html",children:"SQLite"})," format allows you to get benefits of a database, and at the same time the simplicity of storage of data in a file on a disk."]}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsxs)(t.p,{children:["SQLite is the ",(0,s.jsx)(t.a,{href:"https://www.sqlite.org/mostdeployed.html",children:"most used"})," database engine in the world. SQLite is built into all mobile phones and most computers and comes bundled inside countless other applications that people use every day. The SQLite ",(0,s.jsx)(t.a,{href:"https://www.sqlite.org/fileformat2.html",children:"file format"})," is stable, cross-platform, and backwards compatible and the developers pledge to keep it that way through at least the year 2050."]}),"\n",(0,s.jsxs)(t.p,{children:["-- ",(0,s.jsx)(t.a,{href:"https://www.sqlite.org/index.html",children:"SQLite website"}),":"]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"some-use-cases",children:"Some use-cases"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"You think you need MySQL, PostreSQL, etc for your ML project. Usually you don't"}),"\n",(0,s.jsx)(t.li,{children:"You have to deal with hundreds of GB of table-structured data (or larger) and your script (for whatever reason) can't be made parallel."}),"\n",(0,s.jsx)(t.li,{children:"You would request a lot of RAM and work with data slowly."}),"\n"]}),"\n",(0,s.jsx)(t.admonition,{type:"warning",children:(0,s.jsx)(t.p,{children:"This would be a waste of RAM."})}),"\n",(0,s.jsx)(t.admonition,{type:"tip",children:(0,s.jsx)(t.p,{children:"It is better in this case to request smaller amount of RAM and read data (efficiently) from disk - for example using SQLite"})}),"\n",(0,s.jsx)(t.h3,{id:"benefits",children:"Benefits:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"You are not limited by RAM any longer"}),"\n",(0,s.jsx)(t.li,{children:"Compared to other file formats SQLite is very good in selecting certain lines (especially if you use indexing)"}),"\n",(0,s.jsxs)(t.li,{children:["You can use familiar dplyr syntax or execute SQL queries directly","\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"https://dplyr.tidyverse.org/",children:"dplyr"})," is an interface for working with data in a database, not for modifying remote tables."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"https://dbi.r-dbi.org/",children:"DBI package"})," allows to both read and modify tables"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["SQLite is ",(0,s.jsx)(t.a,{href:"https://www.sqlite.org/speed.html",children:"actually faster for common data analysis tasks"})," than other popular databases."]}),"\n",(0,s.jsx)(t.li,{children:"You can have multiple threads accessing an SQLite database simultaneously (for read operations. Writing is more tricky)"}),"\n",(0,s.jsx)(t.li,{children:"Merging/Joining datasets on disk"}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"major-benefits-of-sqlite-compared-to-mysql-postgresql-etc",children:"Major benefits of SQLite compared to MySQL (PostgreSQL, etc)"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"You control your own data (sqlite file). You don't depend on any service like MySQL"}),"\n",(0,s.jsx)(t.li,{children:"You can copy a file to your own laptop and work with it"}),"\n",(0,s.jsxs)(t.li,{children:["Again, ",(0,s.jsx)(t.a,{href:"https://www.sqlite.org/speed.html",children:"SQLite is faster"}),"!"]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"limits",children:"Limits"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"SQLite has some limitations in terms of concurrency, which usually don't apply for typical ML/AI jobs."}),"\n",(0,s.jsxs)(t.li,{children:["See ",(0,s.jsx)(t.a,{href:"https://medium.com/@gwendal.roue/four-different-ways-to-handle-sqlite-concurrency-db3bcc74d00e",children:"Four Different Ways To Handle SQLite Concurrency"})," for more information."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"command-line-cli-example",children:"Command line (CLI) example"}),"\n",(0,s.jsx)(t.p,{children:"Create environment"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"mkdir projects/sqlite-test\ncd projects/sqlite-test\nconda create -p ./cenv\nconda activate ./cenv\nconda install -y sqlite\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Then ",(0,s.jsx)(t.a,{href:"https://sqlite.org/cli.html",children:"follow this SQLite example"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"sqlite3 db_file.sqlite\ncreate table tbl1(one varchar(10), two smallint);\ninsert into tbl1 values('hello!',10);\ninsert into tbl1 values('goodbye', 20);\nselect * from tbl1;\n"})}),"\n",(0,s.jsx)(t.p,{children:"Now Close session (Ctrl-D)."}),"\n",(0,s.jsx)(t.p,{children:"Reopen session to check if changes are saved"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"sqlite3 db_file.sqlite\nselect * from tbl1;\n"})}),"\n",(0,s.jsx)(t.h2,{id:"r-example",children:"R example"}),"\n",(0,s.jsx)(t.h3,{id:"install",children:"Install"}),"\n",(0,s.jsx)(t.p,{children:"Here we use conda, as a great way to keep everything isolated and reproducible."}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsx)(t.p,{children:"conda will install pre-compiled packages. Which is good (faster) and bad (not fully optimized for a specific hardware)"})}),"\n",(0,s.jsxs)(t.admonition,{type:"tip",children:[(0,s.jsxs)(t.p,{children:["Alternative: install packages to a local directory or use renv as described in ",(0,s.jsx)(t.a,{href:"/rts-docs-dev/pr-preview/pr-120/docs/hpc/tools_and_software/r_packages_with_renv",children:"R Packages with renv"})]}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"mkdir /scratch/$USER/projects/myTempProject\ncd  /scratch/$USER/projects/myTempProject\n\nmodule load anaconda3/2020.07\n\nconda create -p ./cenv -c conda-forge r=4.1\nconda activate ./cenv\nconda install -c r r-rsqlite\nconda install -c r r-tidyverse\nconda install -c conda-forge r-remotes\nconda install -c r r-feather\nconda install -c r r-nycflights13\n"})}),(0,s.jsxs)(t.admonition,{type:"note",children:[(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"https://github.com/r-dbi/RSQLite/issues/268",children:"window functions (row_number in particular) require newer version of rsqlite"})}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-R",children:'R\nremotes::install_github("r-dbi/RSQLite")\n## update ALL\n'})})]})]}),"\n",(0,s.jsxs)(t.admonition,{type:"tip",children:[(0,s.jsx)(t.p,{children:"Save list of installed packages for reproducibility"}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"## conda list --export > requirements.txt\n"})})]}),"\n",(0,s.jsx)(t.h3,{id:"use",children:"Use"}),"\n",(0,s.jsx)(t.p,{children:"Many examples can be found here:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://solutions.posit.co/connections/db/databases/sqlite/",children:"SQL syntax"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://solutions.posit.co/connections/db/r-packages/dplyr/",children:"dplyr syntax"})}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-R",children:'library(tidyverse)\nlibrary(DBI)\n# Create RSQLite database file with name "allData"\ncon <- dbConnect(RSQLite::SQLite(), "allData")\n'})}),"\n",(0,s.jsx)(t.p,{children:"Copy data frame to database (dplyr)"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-R",children:'copy_to(con, nycflights13::flights, "fl", temporary=FALSE)\n'})}),"\n",(0,s.jsx)(t.p,{children:"Or copy data to database using DBI"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-R",children:'dbCreateTable(con, "fl", nycflights13::flights, temporary = FALSE)\ndbAppendTable(con, "fl", nycflights13::flights)\n'})}),"\n",(0,s.jsx)(t.p,{children:"Connect to a specific table"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-R",children:'dbListTables(con)\ndf_con <- tbl(con, "fl")\n## check number of rows\ndf_con %>% count()\n'})}),"\n",(0,s.jsx)(t.p,{children:"Subset"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-R",children:"df_temp <- df_con %>% filter( row_number() %in%  c(1, 3) ) %>% collect\n"})}),"\n",(0,s.jsx)(t.p,{children:"Save as feather"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-R",children:'feather::write_feather(df_temp, paste0("file_", ind, ".feather"))\n'})}),"\n",(0,s.jsx)(t.h3,{id:"alternative-read-csv-file-to-sqlite-directly",children:"Alternative: read csv file to SQLite directly"}),"\n",(0,s.jsx)(t.p,{children:"If you already have a large csv file on disk, and you don't want to read it to RAM, you can read it to SQLite file directly"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-R",children:'conda install -c conda-forge r-sqldf \nR\nlibrary(sqldf)\n## create data file\nsqldf("attach allData as new")\n## read file directly from csv to sqlite\nread.csv.sql(file = "test.tab", sql = "create table states_data as select * from file", dbname = "allData")\n'})}),"\n",(0,s.jsx)(t.h2,{id:"ui-for-sqlite---sqlitestudio",children:"UI for SQLite - SQLiteStudio"}),"\n",(0,s.jsxs)(t.p,{children:["Once you have SQLite file, you can easily transfer it to your own laptop and explore it using ",(0,s.jsx)(t.a,{href:"https://sqlitestudio.pl/",children:"SQLiteStudio"}),", if you like to use UI instead of terminal"]})]})}function h(e={}){let{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},89447:function(e,t,n){n.d(t,{Z:()=>r,a:()=>l});var i=n(39546);let s={},a=i.createContext(s);function l(e){let t=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);